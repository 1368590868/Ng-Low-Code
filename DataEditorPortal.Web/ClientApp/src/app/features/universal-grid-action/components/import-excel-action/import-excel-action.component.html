<div *ngIf="step === 1" class="mb-3 overflow-auto">
  <div class="mb-3">
    <p-button
      icon="pi pi-file"
      (onClick)="onNewImport('Add')"
      styleClass="p-button-outlined"
      label="Batch of Add"></p-button>
    <p-button
      class="ml-3"
      icon="pi pi-file"
      (onClick)="onNewImport('Update')"
      styleClass="p-button-outlined"
      label="Batch of Update"></p-button>
  </div>

  <p-table
    [value]="importFileList"
    [paginator]="true"
    [rows]="5"
    [showCurrentPageReport]="false">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="name">
          Name <p-sortIcon field="name"></p-sortIcon>
          <p-columnFilter
            style="vertical-align: middle"
            type="text"
            field="name"
            display="menu"
            [hideOnClear]="true"
            [showOperator]="false"
            [showAddButton]="false"
            [maxFractionDigits]="4"></p-columnFilter>
        </th>
        <th pSortableColumn="createByUser">
          Create By User <p-sortIcon field="createByUser"></p-sortIcon>
          <p-columnFilter
            style="vertical-align: middle"
            type="text"
            field="createByUser"
            display="menu"
            [hideOnClear]="true"
            [showOperator]="false"
            [showAddButton]="false"
            [maxFractionDigits]="4"></p-columnFilter>
        </th>
        <th pSortableColumn="createdDate">
          Create Date <p-sortIcon field="createdDate"></p-sortIcon>
          <p-columnFilter
            style="vertical-align: middle"
            type="text"
            field="createdDate"
            display="menu"
            [hideOnClear]="true"
            [showOperator]="false"
            [showAddButton]="false"
            [maxFractionDigits]="4"></p-columnFilter>
        </th>
        <th pSortableColumn="status">Status</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-fileList>
      <tr>
        <td>{{ fileList.name }}</td>
        <td>{{ fileList.createByUser }}</td>
        <td>{{ fileList.createdDate | date : 'dd/MM/YYYY HH:mm:ss' }}</td>
        <td>
          <app-import-status
            [rowData]="fileList"
            [gridName]="gridName"
            [file]="file"></app-import-status>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-columns>
      <tr class="h-10rem">
        <td class="text-lg text-center" [attr.colspan]="6">
          No records found.
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<div *ngIf="step !== 1">
  <h2>Batch of {{ stepType }}</h2>
</div>

<div *ngIf="step === 2" class="overflow-auto p-1">
  <div class="upload-label flex align-items-center mb-3">
    <span
      ><label class="line-height-3">Download Template</label
      ><i
        class="pi pi-question-circle ml-2"
        pTooltip="Please download the template first and then import it."
        [hideDelay]="500"
        [escape]="false"></i
    ></span>
    <p-button
      icon="pi pi-file"
      (onClick)="onDownloadTemplate()"
      styleClass="p-button-link"
      label="Batch {{ stepType }} Template"></p-button>
  </div>

  <div class="upload-label flex align-items-center mb-3">
    <span class="line-height-3">Import Excel</span>
    <p-button
      icon="pi pi-file"
      styleClass="p-button-outlined"
      [label]="file?.fileName ?? 'Upload'">
      <p-fileUpload
        [style]="{ position: 'absolute', top: 0, left: 0, opacity: 0 }"
        #upload
        name="files"
        styleClass="w-auto"
        [url]="apiUrl + 'attachment/upload-temp-file'"
        mode="basic"
        [auto]="false"
        [maxFileSize]="5000000"
        [fileLimit]="1"
        accept=".xls,.xlsx,.xlsm,.xlsb,.xml,.csv"
        (onSelect)="onSelect($event, upload)"
        (onUpload)="onUpload($event)"
        (onError)="onUploadError($event, upload)"
        [chooseLabel]="file?.fileName ?? 'Upload'"></p-fileUpload>
    </p-button>
  </div>
</div>

<div *ngIf="step === 3" class="flex flex-column overflow-auto p-1">
  <div class="flex align-items-center" *ngIf="statusList.length > 1">
    <p-button
      *ngIf="innerInfoList && innerInfoList.length > 0"
      (onClick)="onShowInfo(-1)"
      [styleClass]="clickFilterButton === -1 ? '' : 'p-button-outlined'"
      [badge]="innerInfoList.length.toString()"
      label="All"></p-button>
    <p-button
      class="ml-1"
      *ngFor="let data of statusList"
      (onClick)="onShowInfo(data['__status__'])"
      styleClass="p-button-outlined"
      [styleClass]="
        clickFilterButton === data['__status__'] ? '' : 'p-button-outlined'
      "
      [badge]="data.data.length"
      label="{{
        data['__status__'] === 0
          ? 'Ready To Import'
          : data['__status__'] === 1
          ? 'Duplicate'
          : data['__status__'] === 2
          ? 'Missing Fields'
          : data['__status__'] === 3
          ? 'Validation Error'
          : data['__status__'] === 4
          ? 'Already Exists'
          : 'Unknown Error'
      }}"></p-button>
  </div>

  <div *ngIf="infoList && infoList.length > 0">
    <p-divider>Information Data</p-divider>
    <p-table
      class="data-table"
      [value]="infoList"
      [paginator]="true"
      [rows]="5"
      [columns]="columns"
      [showCurrentPageReport]="false">
      <ng-template pTemplate="header" let-columns>
        <tr>
          <th [style.min-width]="'12rem !important'">Status</th>
          <ng-container *ngFor="let col of columns">
            <th
              *ngIf="col.header !== '__status__'"
              [pSortableColumn]="col.header"
              [style.min-width]="'12rem !important'">
              <span style="vertical-align: middle">{{ col.header }}</span>
              <p-sortIcon [field]="col.header"></p-sortIcon>
              <p-columnFilter
                style="vertical-align: middle"
                type="text"
                [field]="col.header"
                display="menu"
                [hideOnClear]="true"
                [showOperator]="false"
                [showAddButton]="false"
                [maxFractionDigits]="4"></p-columnFilter>
            </th>
          </ng-container>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-infoList let-columns="columns">
        <tr>
          <td>
            <p-tag
              [severity]="infoList['__status__'] === 0 ? 'success' : 'warning'"
              >{{
                infoList['__status__'] === 0
                  ? 'Ready To Import'
                  : infoList['__status__'] === 1
                  ? 'Duplicate'
                  : infoList['__status__'] === 2
                  ? 'Missing Fields'
                  : infoList['__status__'] === 3
                  ? 'Validation Error'
                  : infoList['__status__'] === 4
                  ? 'Already Exists'
                  : 'Unknown Error'
              }}</p-tag
            >
          </td>
          <ng-container *ngFor="let col of columns">
            <td *ngIf="col.header !== '__status__'">
              <div
                [class]="
                  (col.header | hasError : infoList?.__errors__)
                    ? 'hasError w-full h-full'
                    : null
                "
                [pTooltip]="
                  (col.header | hasError : infoList?.__errors__) ?? ''
                ">
                {{ infoList[col.header] ?? '&nbsp;' }}
              </div>
            </td>
          </ng-container>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<div class="dialog-footer flex justify-content-between">
  <div class="ml-1">
    <p-button
      *ngIf="step !== 1"
      icon="pi pi-angle-left"
      (onClick)="onBack()"
      label="Back"
      styleClass="p-button-text"></p-button>
  </div>
  <div>
    <p-button
      *ngIf="step !== 1"
      icon="pi pi-times"
      (onClick)="onCancel()"
      label="Cancel"
      styleClass="p-button-text"></p-button>
    <p-button
      *ngIf="step !== 1"
      [disabled]="validDisabled(currentStep) || isLoading"
      icon="pi pi-check"
      (onClick)="onOk()"
      [label]="okLabel"
      [loading]="isLoading"></p-button>
  </div>
</div>
