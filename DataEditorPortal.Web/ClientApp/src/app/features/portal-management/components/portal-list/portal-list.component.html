<div class="layout-content py-3 px-3 flex flex-column">
  <div class="p-card flex-grow-1">
    <p-treeTable
      [value]="data"
      styleClass="p-datatable-striped"
      dataKey="id"
      (onContextMenuSelect)="onContextMenuSelect($event)"
      [contextMenu]="cm">
      <ng-template pTemplate="caption">
        <div class="flex align-items-center my-2">
          <h3 class="">Portal Management</h3>
          <p-menu
            #addNewMenu
            [popup]="true"
            [model]="addNewMenuModels"
            appendTo="body"
            [style]="{ width: 'auto' }"></p-menu>
          <div class="ml-auto flex justify-content-between">
            <p-button
              class="mr-2"
              icon="pi pi-file-import"
              styleClass="p-button-outlined"
              label="Import"
              (click)="importDialog.showDialog()"></p-button>
            <p-button
              icon="pi pi-plus"
              styleClass="p-button-outlined"
              label="New"
              (click)="addNewMenu.toggle($event)"></p-button>
          </div>
        </div>
      </ng-template>
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 18%">Label</th>
          <th style="width: 18%">Name</th>
          <th style="width: 12%">Type</th>
          <th>Description</th>
          <th style="width: 12rem">Status</th>
          <th style="width: 5rem"></th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
        <tr [ttContextMenuRow]="rowNode">
          <td style="width: 18%">
            <div class="flex align-items-center">
              <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
              {{ rowData.label }}
            </div>
          </td>
          <td style="width: 18%" style="vertical-align: middle">
            <div class="flex align-items-center">
              <span class="text-center">
                {{ rowData.name }}
              </span>
              <a
                class="ml-3 text-primary"
                *ngIf="rowData.routerLink"
                [routerLink]="rowData.routerLink"
                ><i class="pi pi-link cursor-pointer"></i
              ></a>

              <a
                class="ml-3 text-primary"
                *ngIf="rowData.type === 'External' && rowData.link"
                [href]="rowData.link"
                target="_blank"
                ><i class="pi pi-link cursor-pointer"></i
              ></a>
            </div>
          </td>
          <td style="width: 12%">
            <p-chip
              styleClass="font-medium"
              [label]="!rowData.parentId ? 'Group' : rowData.type"></p-chip>
          </td>
          <td>{{ rowData.description }}</td>
          <td style="width: 12rem">
            <div class="flex align-items-center">
              <p-tag
                *ngIf="rowData.status === 0"
                icon="pi pi-file-edit"
                severity="warning"
                value="Draft"></p-tag>
              <p-tag
                *ngIf="rowData.status === 1"
                icon="pi pi-check"
                severity="success"
                value="Published"></p-tag>
              <p-tag
                *ngIf="rowData.status === 2"
                icon="pi pi-minus-circle"
                severity="warning"
                value="Unpublished"></p-tag>
              <i
                *ngIf="
                  rowData.type === 'Portal Item' &&
                  rowData.configCompleted === false
                "
                class="pi pi-exclamation-circle ml-3 text-lg"
                style="color: var(--yellow-600)"
                pTooltip="You have't completed all configurations"></i>
            </div>
          </td>
          <td style="width: 5rem">
            <p-menu
              #menu
              [popup]="true"
              [model]="contextMenuItems"
              appendTo="body"
              [style]="{ width: 'auto' }"></p-menu>
            <button
              type="button"
              pButton
              icon="pi pi-ellipsis-v"
              class="p-button-rounded p-button-text"
              (click)="onShowMenu(menu, $event, rowNode.node)"></button>
          </td>
        </tr>
      </ng-template>
    </p-treeTable>
    <p-contextMenu
      #cm
      appendTo="body"
      [model]="contextMenuItems"
      styleClass="w-auto"></p-contextMenu>
  </div>
</div>

<app-add-portal-dialog
  #addDialog
  (saved)="onDiaglogSaved()"></app-add-portal-dialog>

<app-import-dialog
  #importDialog
  (saved)="onImportDialogSaved()"></app-import-dialog>

<app-custom-actions #customActions></app-custom-actions>
<p-confirmDialog
  header="Confirmation"
  icon="pi pi-exclamation-triangle"
  rejectButtonStyleClass="p-button-text"
  [style]="{ maxWidth: '40rem' }"></p-confirmDialog>
