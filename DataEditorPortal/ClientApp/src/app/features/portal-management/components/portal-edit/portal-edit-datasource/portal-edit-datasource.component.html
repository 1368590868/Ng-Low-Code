<p-card styleClass="">
  <ng-template pTemplate="title">Data Source </ng-template>
  <ng-template pTemplate="subtitle">
    Setup data source for this portal item.
  </ng-template>
  <p-divider styleClass="mt-0"></p-divider>
  <div class="w-6 pt-3">
    <div class="flex align-items-center">
      <div class="flex flex-column mb-2 mr-4">
        <label for="tableName" class="mb-1">Database Table *</label>
        <div class="flex align-items-center">
          <p-dropdown
            inputId="tableName"
            [(ngModel)]="selectedDbTable"
            [options]="dbTables"
            (onChange)="onTableNameChange($event)"
            [style]="{ minWidth: '20rem' }"></p-dropdown>
          <i
            class="pi pi-question-circle ml-3 text-lg"
            pTooltip="Select one table from database"></i>
        </div>
      </div>
      <div class="flex flex-column mb-2">
        <label for="idColumn" class="mb-1">Id Column *</label>
        <div class="flex align-items-center">
          <p-dropdown
            inputId="idColumn"
            [(ngModel)]="datasourceConfig.idColumn"
            [options]="dbTableColumns"
            [style]="{ minWidth: '20rem' }"
            optionLabel="columnName"
            optionValue="columnName"></p-dropdown>
          <i
            class="pi pi-question-circle ml-3 text-lg"
            pTooltip="Id Column will be used as the key in the grid"></i>
        </div>
      </div>
    </div>
    <p-divider styleClass="mb-0">Filters</p-divider>
    <div class="flex flex-column mb-2">
      <!-- <label class="mb-1">Filters</label> -->
      <p-orderList [value]="datasourceConfig.filters" [stripedRows]="true">
        <ng-template let-filter pTemplate="item">
          <div class="flex align-items-center">
            <div class="mr-3">
              <p-dropdown
                [(ngModel)]="filter.field"
                [options]="dbTableColumns"
                optionLabel="columnName"
                optionValue="columnName"
                (onChange)="onFilterColumnChange($event, filter)"
                appendTo="body"></p-dropdown>
            </div>
            <div class="mr-3">
              <p-dropdown
                [(ngModel)]="filter.matchMode"
                [options]="filter.matchOptions"
                appendTo="body"></p-dropdown>
            </div>
            <div class="mr-3">
              <input
                pInputText
                placeholder="Enter a value"
                [class]="filter.errValue ? 'ng-invalid ng-dirty' : ''"
                (ngModelChange)="onFilterValueChange($event, filter)"
                [(ngModel)]="filter.value" />
            </div>
            <div>
              <p-button
                icon="pi pi-trash"
                styleClass="p-button-rounded p-button-text"
                (onClick)="onRemoveFilter(filter)"></p-button>
            </div>
          </div>
        </ng-template>
      </p-orderList>
      <p-button
        label="Add"
        icon="pi pi-plus"
        class="mt-1"
        styleClass="p-button-text p-button-sm"
        (onClick)="onAddFilter()"></p-button>
    </div>
    <p-divider styleClass="mb-0">Sort By</p-divider>
    <div class="flex flex-column mb-2">
      <!-- <label class="mb-1">Sort By</label> -->
      <p-orderList
        [value]="datasourceConfig.sortBy"
        [stripedRows]="true"
        [dragdrop]="true">
        <ng-template let-sortBy pTemplate="item">
          <div class="flex align-items-center">
            <div class="mr-3">
              <p-dropdown
                [(ngModel)]="sortBy.field"
                [options]="dbTableColumns"
                optionLabel="columnName"
                optionValue="columnName"
                appendTo="body"
                placeholder="Select Id Column"></p-dropdown>
            </div>
            <div class="mr-3">
              <p-dropdown
                [(ngModel)]="sortBy.order"
                [options]="dbOrderOptions"
                appendTo="body"
                placeholder="Order"></p-dropdown>
            </div>
            <div>
              <p-button
                icon="pi pi-trash"
                styleClass="p-button-rounded p-button-text"
                (onClick)="onRemoveSortColumn(sortBy)"></p-button>
            </div>
          </div>
        </ng-template>
      </p-orderList>
      <p-button
        label="Add"
        icon="pi pi-plus"
        class="mt-1"
        styleClass="p-button-text p-button-sm"
        (onClick)="onAddSortColumn()"></p-button>
    </div>
  </div>
  <ng-template pTemplate="footer">
    <div class="flex align-items-center">
      <p-button
        label="Back"
        icon="pi pi-angle-left"
        [disabled]="isLoading || isSaving"
        styleClass="p-button-outlined"
        (onClick)="onBack()"></p-button>
      <p-button
        label="Save Draft & Exit"
        icon="pi pi-save"
        class="ml-auto"
        [disabled]="isLoading || isSaving"
        styleClass="p-button-outlined"
        (onClick)="onSaveAndExit()"
        [loading]="isSaving && isSavingAndExit"></p-button>
      <p-button
        label="Save & Next"
        icon="pi pi-angle-right"
        iconPos="right"
        [style]="{ 'margin-left': '.5em' }"
        [disabled]="isLoading || isSaving"
        (onClick)="onSaveAndNext()"
        [loading]="isSaving && isSavingAndNext"></p-button>
    </div>
  </ng-template>
</p-card>
